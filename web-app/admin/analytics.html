<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analyses & Rapports - Admin</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/admin.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
</head>

<body>
    <div class="admin-layout">
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-logo">
                    <div class="sidebar-logo-icon">üóëÔ∏è</div>
                    <span>Waste AI</span>
                </div>
            </div>

            <nav class="sidebar-nav">
                <div class="nav-section">
                    <div class="nav-section-title">Menu Principal</div>
                    <a href="dashboard.html" class="nav-item">
                        <span class="nav-icon">üìä</span>
                        <span>Tableau de bord</span>
                    </a>
                    <a href="map.html" class="nav-item">
                        <span class="nav-icon">üó∫Ô∏è</span>
                        <span>Carte Interactive</span>
                    </a>
                    <a href="reports.html" class="nav-item">
                        <span class="nav-icon">üìã</span>
                        <span>Gestion Signalements</span>
                    </a>
                    <a href="collections.html" class="nav-item">
                        <span class="nav-icon">üöõ</span>
                        <span>Collectes & Itin√©raires</span>
                    </a>
                </div>

                <div class="nav-section">
                    <div class="nav-section-title">Administration</div>
                    <a href="users.html" class="nav-item">
                        <span class="nav-icon">üë•</span>
                        <span>Gestion Utilisateurs</span>
                    </a>
                    <a href="analytics.html" class="nav-item active">
                        <span class="nav-icon">üìà</span>
                        <span>Analyses & Rapports</span>
                    </a>
                    <a href="settings.html" class="nav-item">
                        <span class="nav-icon">‚öôÔ∏è</span>
                        <span>Param√®tres</span>
                    </a>
                </div>
            </nav>

            <div class="sidebar-footer">
                <div class="user-profile">
                    <div class="user-avatar" id="user-avatar">A</div>
                    <div class="user-info">
                        <div class="user-name" id="user-name">Admin User</div>
                        <div class="user-role" id="user-role">Administrateur</div>
                    </div>
                    <button class="btn-icon btn-secondary" id="logout-btn" title="D√©connexion">üö™</button>
                </div>
            </div>
        </aside>

        <main class="main-content">
            <div class="page-header">
                <div>
                    <h1 class="page-title">Analyses & Rapports</h1>
                    <p class="page-subtitle">Statistiques d√©taill√©es et visualisations</p>
                </div>
                <button class="btn btn-primary">
                    <span>üì•</span>
                    Exporter PDF
                </button>
            </div>

            <div class="grid grid-2 mb-xl">
                <div class="chart-container">
                    <div class="card-header">
                        <h3 class="card-title">Tendance Annuelle</h3>
                    </div>
                    <div class="chart-wrapper" style="height: 350px;">
                        <canvas id="chart-yearly"></canvas>
                    </div>
                </div>

                <div class="chart-container">
                    <div class="card-header">
                        <h3 class="card-title">Volume par Type</h3>
                    </div>
                    <div class="chart-wrapper" style="height: 350px;">
                        <canvas id="chart-volume"></canvas>
                    </div>
                </div>
            </div>

            <div class="grid grid-2 mb-xl">
                <div class="chart-container">
                    <div class="card-header">
                        <h3 class="card-title">Performance Agents</h3>
                    </div>
                    <div class="chart-wrapper" style="height: 350px;">
                        <canvas id="chart-agents"></canvas>
                    </div>
                </div>

                <div class="chart-container">
                    <div class="card-header">
                        <h3 class="card-title">Taux de R√©solution</h3>
                    </div>
                    <div class="chart-wrapper" style="height: 350px;">
                        <canvas id="chart-resolution"></canvas>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">Rapport Hebdomadaire</h3>
                </div>
                <div class="card-body">
                    <div class="grid grid-3 gap-lg">
                        <div>
                            <div class="text-sm text-gray mb-sm">Signalements cette semaine</div>
                            <div class="text-2xl font-bold text-green">127</div>
                            <div class="text-sm text-gray mt-sm">‚Üó +23% vs sem. pr√©c√©dente</div>
                        </div>
                        <div>
                            <div class="text-sm text-gray mb-sm">Taux de traitement</div>
                            <div class="text-2xl font-bold text-green">94%</div>
                            <div class="text-sm text-gray mt-sm">‚Üó +5% vs sem. pr√©c√©dente</div>
                        </div>
                        <div>
                            <div class="text-sm text-gray mb-sm">Temps moyen r√©solution</div>
                            <div class="text-2xl font-bold text-green">2.3h</div>
                            <div class="text-sm text-gray mt-sm">‚Üò -0.5h vs sem. pr√©c√©dente</div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script src="../js/app.js"></script>
    <script>
        if (!Utils.requireAuth('ADMIN')) {
            window.location.href = 'login.html';
        }

        // Chart colors
        const chartColors = {
            green: '#22c55e',
            blue: '#3b82f6',
            yellow: '#f59e0b',
            red: '#ef4444',
            purple: '#8b5cf6'
        };

        // Yearly Trend Chart
        new Chart(document.getElementById('chart-yearly'), {
            type: 'line',
            data: {
                labels: ['Jan', 'F√©v', 'Mar', 'Avr', 'Mai', 'Jun', 'Jul', 'Ao√ª', 'Sep', 'Oct', 'Nov', 'D√©c'],
                datasets: [{
                    label: 'Signalements',
                    data: [65, 78, 90, 81, 95, 110, 125, 118, 130, 142, 155, 168],
                    borderColor: chartColors.green,
                    backgroundColor: 'rgba(34, 197, 94, 0.1)',
                    tension: 0.4,
                    fill: true
                }, {
                    label: 'R√©solus',
                    data: [60, 72, 85, 78, 88, 102, 118, 110, 122, 135, 145, 158],
                    borderColor: chartColors.blue,
                    backgroundColor: 'rgba(59, 130, 246, 0.1)',
                    tension: 0.4,
                    fill: true
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { labels: { color: '#9ca3af' } } },
                scales: {
                    y: { grid: { color: 'rgba(255,255,255,0.1)' }, ticks: { color: '#9ca3af' } },
                    x: { grid: { color: 'rgba(255,255,255,0.1)' }, ticks: { color: '#9ca3af' } }
                }
            }
        });

        // Volume by Type Chart
        new Chart(document.getElementById('chart-volume'), {
            type: 'bar',
            data: {
                labels: ['M√©nager', 'Verts', 'Construction', '√âlectronique', 'Dangereux'],
                datasets: [{
                    label: 'Volume (m¬≥)',
                    data: [450, 280, 320, 150, 80],
                    backgroundColor: [chartColors.green, chartColors.blue, chartColors.yellow, chartColors.purple, chartColors.red]
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { display: false } },
                scales: {
                    y: { grid: { color: 'rgba(255,255,255,0.1)' }, ticks: { color: '#9ca3af' } },
                    x: { grid: { display: false }, ticks: { color: '#9ca3af' } }
                }
            }
        });

        // Agents Performance Chart
        new Chart(document.getElementById('chart-agents'), {
            type: 'bar',
            data: {
                labels: ['Agent 1', 'Agent 2', 'Agent 3', 'Agent 4', 'Agent 5'],
                datasets: [{
                    label: 'Collectes r√©alis√©es',
                    data: [45, 52, 38, 48, 55],
                    backgroundColor: chartColors.green
                }]
            },
            options: {
                indexAxis: 'y',
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { labels: { color: '#9ca3af' } } },
                scales: {
                    x: { grid: { color: 'rgba(255,255,255,0.1)' }, ticks: { color: '#9ca3af' } },
                    y: { grid: { display: false }, ticks: { color: '#9ca3af' } }
                }
            }
        });

        // Resolution Rate Chart
        new Chart(document.getElementById('chart-resolution'), {
            type: 'doughnut',
            data: {
                labels: ['< 2h', '2-4h', '4-8h', '> 8h'],
                datasets: [{
                    data: [35, 40, 18, 7],
                    backgroundColor: [chartColors.green, chartColors.blue, chartColors.yellow, chartColors.red]
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { position: 'bottom', labels: { color: '#9ca3af' } } }
            }
        });
    </script>
</body>

</html>